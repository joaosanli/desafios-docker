version: '3.8'

services:
  gateway:
    build:
      context: .
      dockerfile: Dockerfile.gateway
    container_name: gateway
    ports:
      - "5000:5000"
    environment:
      - USERS_URL=http://users:5003
      - ORDERS_URL=http://orders:5004
    networks:
      - api
    depends_on:
      users:
        condition: service_healthy
      orders:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  users:
    build:
      context: .
      dockerfile: Dockerfile.users
    container_name: users
    networks:
      - api
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5003/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  orders:
    build:
      context: .
      dockerfile: Dockerfile.orders
    container_name: orders
    networks:
      - api
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5004/health"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  api:
    driver: bridge
